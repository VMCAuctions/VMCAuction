<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Package creation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/additional-methods.min.js"></script>
  </head>
  <body>
    <!-- <script>
      function test(){
        alert('hello')
      }
    </script> -->
    <%if(admin){%>
    <%- include('adminHeader') -%>
    <%}else{%>
      <%- include('header') -%>
    <%}%>
    <div class="container mt-4">
      <h3>Create Package</h3>
      <form id="packageForm" action="/<%=auction%>/packages" method="post">
        <div class="form-group">
          <label for="packageName">Package Name</label>
          <input type="text" name="packageName" id="packageName" class="form-control">
        </div>

        <div class="form-group">
          <label for="packageDescription">Package Description</label>
          <textarea class="form-control" name="packageDescription" id="packageDescription" rows="8" cols="40"></textarea>
        </div>
        <!-- priority is asscending currently 0 would be at the top of the page -->
        <div class="form-group">
          <label for="priority">Feature Level</label>
          <input id="priority" type='number' name='priority' placeholder='Priority' class="form-control">
        </div>

        <div class="form-group">
          <label for="">Category</label>
          <select name="category" id="category" class="form-control">

            <% for (var c in categories){%>
              <!-- add radio and jquery to make only one catagory option apear
              or Make a seperate page to creat catagories -->
              <option value="<%=categories[c].name%>"><%=categories[c].name%></option>
              <%}%>
            </select>
        </div>
          <div class="form-group row">
            <div class="col-6">
              <input type="number" name="openingBid" id="openingBid" placeholder="Opening Bid" class="form-control">
            </div>
            <div class="col-6">
              <input type="number" name="increments" id="increments" placeholder="increment" class="form-control">
            </div>
          </div>

          <div class="form-group">
          </div>

          <!-- need a read only feild with the current number selected -->
          <div class="alert alert-secondary">
          <div class="form-check">
            <div class="row">
              <label for="">Items</label>
            </div>
            <%for (var i in items){%>
              <%if(!items[i].packaged){%>
                <br>
                <input class="form-check-input" required value="<%=items[i]._id%>" type="checkbox" name="selectedItems" id="<%=items[i]._id%>" onChange='totalAdd(<%=items[i].value%>, <%=items[i]._id%>)'>
                <label for="<%=items[i]._id%>"><%=items[i].name%></label>
                <p><strong>Restrictions:</strong> <%= items[i].restrictions %></p>
                <p>Fair Market Value: <%= items[i].value %></p>
                <%}%>
                <%}%>
          </div>
          </div>
          <button type="button" class="btn btn-primary mb-4" data-toggle="modal" data-target="#exampleModal">
            Add More Items...
          </button>
          <div class="form-group">
            <label for="packageRestrictions">Package Restrictions</label>
            <textarea class="form-control" name="packageRestrictions" id="packageRestrictions" rows="4" cols="40"></textarea>
          </div>
          <div class="form-group">
            <label for="totalValue">Total Value</label>
            <input readonly id="totalValue" type="number" name="totalValue" value="0" class="form-control">
          </div>
          <a href="/<%=auction%>/organizer-menu" class="btn btn-secondary">Back</a>
          <input type="submit" name="submit" value="Submit" class="btn btn-primary">
          <!-- Button trigger modal -->

          <!-- Modal -->
          <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Items</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <h5>Clicker</h5>
                  <p><a href="#" role="button" class="btn btn-secondary popover-test" title="Popover title" data-content="I'm cool.">PLEASE WORK</a></p>
                  <hr>
                  <div class="col-lg-6">
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Search for...">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">Go!</button>
                      </span>
                    </div>
                  </div><!-- /.col-lg-6 -->
                  <%for (var i in items){%>
                    <%if(!items[i].packaged){%>
                      <br>
                      <input class="form-check-input" required value="<%=items[i]._id%>" type="checkbox" name="selectedItems" id="<%=items[i]._id%>" onChange='totalAdd(<%=items[i].value%>, <%=items[i]._id%>)'>
                      <label for="<%=items[i]._id%>"><%=items[i].name%></label>
                      <p><strong>Restrictions:</strong> <%= items[i].restrictions %></p>
                      <p>Fair Market Value: <%= items[i].value %></p>
                      <%}%>
                      <%}%>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary">Save changes</button>
                </div>
              </div>
            </div>
          </div>
          </form>
    </div>
    <script>
      $(document).ready(function(){

        var total = 0;
        var checkedItems = {};
        totalAdd = function(value, id){
          var checkbox = document.getElementById(id);
          if (checkbox.checked === true){
            total += value
            console.log("total is", total);
            checkedItems[id]= id;
            console.log(checkedItems);
          }
          else if (checkbox.checked === false) {
            total -= value
            delete checkedItems[id]
            console.log(checkedItems)
          }
          document.getElementById('totalValue').value = total
        }
        var validator = $("#packageForm").validate({
          rules: {
            packageName: {
              required: true,
              minlength: 4
            },
            category: {
              required: true
            },
            openingBid:{
              required: true,
              number: true,
              min: 0
            },
            packageDescription: {
              required: true,
              minlength: 4
            },
            increments: {
              required: true,
              number: true,
              min: 5,
              step: 5
            },
            priority: {
              required: true,
              number: true,
              min: 0
            }
          }
        });
        validator.form();
        if (window.location.search.substring(1) == 'true') {
          alert('that was a success')
        }
      })
    </script>
  </body>
</html>
