<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
	<title>Package Show</title>
	<link rel="stylesheet" type="text/css" href="/css/style.css">
	<link rel="stylesheet" href="http://cdn.dhtmlx.com/edge/dhtmlx.css" type="text/css"> 
	<link rel="stylesheet" type="text/css" href="/css/packageUprights.css">
	<script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
	<script src="http://cdn.dhtmlx.com/edge/dhtmlx.js" type="text/javascript"></script>
	<style>

		.upright {
			/* width: 816px;
			height: 1054px; */
			width: 400px;
			height: 518px;
			text-align: center;
			background: rgb(32, 108, 194);
			color: #fff;
			padding: 15px 0px;
		}

		.donor {
			background: black;
			width: 100%;
			height: 8%;
			position: relative;
			font-size: 12px;
			padding: 1% 0px;
		}

		.resized-text {
			width: 90%;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		.title {
			width: 100%;
			height: 9%;
			font-size: 60px;
			position: relative;
			margin: 2% 0px;
			font-weight: bold;
			letter-spacing: 0.5px;
			/* background: pink; */
		}

		.image {
			width: 100%;
			height: 40%;
			margin-bottom: 5%;
			/* font-size: 30px; */
			font-size: 14px;
		}

		.flexible-photo {
			max-width: 90%;
			max-height: 100%;
			/* border: 15px solid black; */
			border: 5px solid black;
		}

		.packageId {
			background: black;
			position: relative;
			bottom: 93%;
			width: 30%;
			text-align: right;
			padding: 1% 4% 1% 0px;
		}

		.value {
			background: black;
			position: relative;
			bottom: 36.5%;
			left: 70%;
			width: 30%;
			text-align: left;
			padding-left: 5%;
			padding: 1% 0px 1% 4%;
		}

		#fitin {
			font-size: 20px;
			background: black;
			width: 100%;
			height: 35%;
			position: relative;
			padding: 3% 0px;
		}
	</style> 

	<script>
		$(function() {
			$('#fitin div').css('font-size', '1em');
			
			while( $('#fitin div').height() > $('#fitin').height() ) {
				$('#fitin div').css('font-size', (parseInt($('#fitin div').css('font-size')) - 1) + "px" );
			}

			$('.donor div').css('font-size', '1em');
			
			while( $('.donor div').height() > $('.donor').height() ) {
				$('.donor div').css('font-size', (parseInt($('.donor div').css('font-size')) - 1) + "px" );
			}

			$('.title div').css('font-size', '1em');
			
			while( $('.title div').height() > $('.title').height() ) {
				$('.title div').css('font-size', (parseInt($('.title div').css('font-size')) - 1) + "px" );
			}
			
		});

		var myCP;
		function doOnLoad() {
			myCP = new dhtmlXColorPicker({
				parent: "cpObj",
				custom_colors: ["#206cc2", "#000000", "#FFFFFF"],
				closeable: false
			});
			myCP.attachEvent("onChange", setColor);
		};
		
		function doOnUnload() {
			if (myCP != null) {
				myCP.unload();
				myCP = null;
			}
		};
		
		function setColor(color) {
			var ct = document.getElementById("colorType");
			var inp = document.getElementById("bg");
			var titleColor = document.getElementById("titleText");
			var secondary = document.querySelectorAll(".secondaryColor");
			var secondaryBorder = document.querySelector('#photoBorder');
			var mainTextColors = document.querySelectorAll('.mainTextColor');

			switch (ct.value) {
				case "text":
					mainTextColors.forEach(function(item) {
						item.style.color = color;
					});
					break;
				case "bg":
					inp.style.backgroundColor =  color;
					break;
				case "title":
					titleColor.style.color = color;
					break;
				case "secondary":
					secondary.forEach(function(item) {
						item.style.backgroundColor =  color;
					});
					secondaryBorder.style.border = `5px solid ${color}`;
					break;
			}
		};
	</script>
	
  </head>

	<body onload="doOnLoad();" onunload="doOnUnload();">
		<%if(admin){%>
			<%- include('adminHeader') -%>
			<%}else{%>
				<%- include('header') -%>
		<%}%>
		<%if(admin == 0){%>
			<%- include('footerClock') -%>
		<%}%>

		<div class="container">
			<div class="row">
				<div class="col">
					<h2 class="my-4 ml-1">Package Upright</h2>

					<form class="form">
						<div class="upright bg" id="bg">
		
							<div class="donor secondaryColor mainTextColor">
								<div class="resized-text">
									Donors: Mr. & Mrs. Jones, Larry Graham
								</div>
							</div>
		
							<div class="title" id="titleText">
								<div class="resized-text">
									<%= package.name %>
								</div>
							</div>
		
							<div class="image">
								<img class="flexible-photo" id="photoBorder" src="/<%= package.photo %>">
								
								<div class="packageId secondaryColor mainTextColor">
									#<%= package._id%>
								</div>
		
								<div class="value secondaryColor mainTextColor">
									Value: $<%= package.value%>
								</div>
							</div>
		
							<div id="fitin" class="secondaryColor mainTextColor">
								<div class="resized-text">
									<%= package.description %>
								</div>
							</div>
						</div>
					</form>
				</div>
			
				<div class="col mt-5">
					<div class="mt-4">
						<h5>Edit Colors: </h5>
						<select id="colorType">
							<option value="bg">Background color</option>
							<option value="text">Text color</option>
							<option value="title">Title color</option>
							<option value="secondary">Secondary color</option>
						</select>
					</div>
			
					<div id="cpObj"></div>
			
					<input type="button" id="create_pdf" value="Open PDF">
				</div>
			</div>
		</div>
		
		<script>  
			(function () {  
				var  
					form = $('.form'),  
					cache_width = form.width(),  
					// a4 = [2550, 3300];
					// a4 = [563, 750];
					a4 = [400, 518];
			
				$('#create_pdf').on('click', function () {  
					$('body').scrollTop(0);  
					createPDF();  
				});  

				//create pdf  
				function createPDF() {  
					getCanvas().then(function (canvas) {  
						var  
							img = canvas.toDataURL("image/png"),  
							doc = new jsPDF({  
								unit: 'in',  
								// format: 'letter' 
								// format: [8.5, 11]
								format: [4.17, 5.4]
							});  
						doc.addImage(img, 'JPEG', 0, 0);  
						window.open(URL.createObjectURL(doc.output("blob")));
						form.width(cache_width);  
					});  
				}  
			
				// create canvas object  
				function getCanvas() {  
					form.width((a4[0] * 1.33333) - 80).css('max-width', 'none');  
					return html2canvas(form, {
						scale: 2,
						imageTimeout: 2000,  
						removeContainer: true  
					});  
				}  
			
			}());  
		</script>
	</body>
</html>